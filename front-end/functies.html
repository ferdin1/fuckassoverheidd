<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alle Functies - Rijksoverheid</title>
    <link rel="stylesheet" href="css/rijkshuisstijl.css">
</head>

<body>
    <header class="rijk-top-bar">
        <div class="rijk-header-top">
            <a href="dashboard.html" class="rijk-logo-link">
                <img src="https://www.rijkshuisstijl.nl/publiek/general/filestreamer.ashx?d=vePBKGSkhy7hArZX2fPnf67BDM1fdkK%2B22LcON6gT80KUVyGS%2Fw1GGkIgB2LbnNfAa77kkFAGIPKK5Ll7A0Vp1X8BPrR%2FBHYwrYEdKpPX0ADg1F7Pu5vAfJ6VS4Bfl%2FXypjYJVLFt5eALy3vNueZGI5YAjdAF%2FSyy9cCYK4Ck91pjXT7KzerH3%2BkJpLxkmZ%2F6OPSkTN4WqfVbx68D1eFTOb7kil7Ka9AjS0J%2BPcL19DojCVnYR4PgeS6J2BGk%2FLaa7j%2B88BAel7x1W4jbKD5KEf%2Bu6TQdVuSMWuinTiOW7cPgSGSfmipO2Dq3VnXYBHm1nWBtPDHn3YlpZWu7fSFD4bd5t%2B2jMIUN81yTvThr%2BQ%3D"
                    alt="Rijksoverheid Logo" class="rijk-logo">
               
                <span class="rijk-ministry">Ministerie van Justitie en Veiligheid</span>
            </a>
        </div>
        <div class="rijk-header-nav">
            <nav class="rijk-main-nav">
                <a href="dashboard.html" class="rijk-nav-link">Home</a>
                <a href="kaart.html" class="rijk-nav-link">Kaart</a>
                <a href="functies.html" class="rijk-nav-link active">Functies</a>
             <button class="rijk-nav-link"
                    onclick="window.open('https://www.rijksoverheid.nl/')">Over ons</button>
              
            </nav>
            <div class="rijk-search-container">
                <input type="search" class="rijk-search-input" placeholder="Waar bent u naar op zoek?">
                <button class="rijk-search-btn">üîç</button>
            </div>
            <div>
                <span id="userRoleDisplay" class="rijk-nav-link">Rol: Gast</span>
            
            </div>
        </div>
    </header>
    <script src="auth.js"></script>

    <div class="rijk-functies-layout">
        <div class="rijk-sidebar">
            <div class="rijk-search-box">
                <input type="text" id="searchInput" class="rijk-input" placeholder="Zoek op titel...">
            </div>
            <button class="rijk-btn rijk-btn-secondary" id="addBtn">‚ûï Nieuwe functie toevoegen</button>
            <div class="rijk-function-list" id="functionList"></div>
        </div>

        <div class="rijk-content-area">
            <div class="rijk-content-card-float">
                <div class="rijk-content-header">
                    <h2 id="cardTitle">Titel</h2>
                </div>
                <div class="rijk-content-section">
                    <h3>Beschrijving</h3>
                    <p id="cardDesc">Beschrijving</p>
                </div>
                <div class="rijk-content-section">
                    <h3>Benodigdheden</h3>
                    <p id="cardBenodigd">Benodigdheden</p>
                </div>
                <div class="rijk-content-footer">
                    <span>Opleiding</span>
                    <span class="rijk-badge" id="cardOpleiding">MBO</span>
                </div>
                <div class="rijk-content-section flex-between">
                    <button class="rijk-btn rijk-btn-secondary" id="savePersonalBtn">Opslaan in Mijn Functies</button>
                    <button class="rijk-btn" id="planRouteBtn">Bekijk Route in Planner</button>
                </div>
            </div>
        </div>
    </div>

    <!-- POPUP -->
    <div class="rijk-modal" id="popup">
        <div class="rijk-modal-content">
            <h2>Nieuwe functie aanmaken</h2>
            <form id="form">
                <div class="rijk-form-group">
                    <label class="rijk-label">Functie titel *</label>
                    <input type="text" id="titel" class="rijk-input" required>
                </div>
                <div class="rijk-form-group">
                    <label class="rijk-label">Cursus benodigd *</label>
                    <input type="text" id="cursus" class="rijk-input" required>
                </div>
                <div class="rijk-form-group">
                    <label class="rijk-label">Vorige functie nodig om te doen*</label>
                    <input type="text" id="vervolg_functie" class="rijk-input" required>
                </div>
                <div class="rijk-form-group">
                    <label class="rijk-label">Beschrijving *</label>
                    <textarea id="beschrijving" class="rijk-textarea" required></textarea>
                </div>
                <div class="rijk-form-group">
                    <label class="rijk-label">Benodigdheden *</label>
                    <textarea id="benodigd" class="rijk-textarea" required></textarea>
                </div>
                <div class="rijk-form-group">
                    <label class="rijk-label">Opleiding niveau *</label>
                    <select id="opleiding" class="rijk-select" required>
                        <option value="">Kies</option>
                        <option value="MBO">MBO</option>
                        <option value="HBO">HBO</option>
                        <option value="WO">WO</option>
                    </select>
                </div>
                <div class="flex-between flex-gap">
                    <button type="button" class="rijk-btn rijk-btn-outline" id="cancelBtn">Annuleren</button>
                    <button type="submit" class="rijk-btn">Toevoegen</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data Layer (MySQL PHP API Integration)
        const API_URL = 'api';
        const defaultData = {
            1: { titel: "Medewerker Administratie", beschrijving: "Verantwoordelijk voor het verwerken, controleren en bijhouden van administratieve en financi√´le gegevens binnen het CJIB.", benodigd: "MBO-diploma in administratieve richting. Basiskennis administratie, nauwkeurig werken en ervaring met computersystemen.", opleiding: "MBO", cursus: "Basisadministratie", vervolg_functie: "Junior Administratie" },
            2: { titel: "Juridisch Medewerker", beschrijving: "Ondersteunt bij juridische processen zoals het controleren van dossiers en het behandelen van bezwaren.", benodigd: "HBO-diploma in juridische richting. Kennis van wet- en regelgeving en ervaring met dossierbehandeling.", opleiding: "HBO", cursus: "Bestuursrecht Basis", vervolg_functie: "Rechtshulp Medewerker" },
            3: { titel: "Klantenservice Medewerker", beschrijving: "Beantwoordt vragen van burgers over boetes, betalingen en procedures.", benodigd: "MBO-diploma. Goede communicatieve vaardigheden en bij voorkeur ervaring in klantenservice.", opleiding: "MBO", cursus: "Communicatie & Klantcontact", vervolg_functie: "Callcenter Medewerker" },
            4: { titel: "Behandelaar Bezwaar", beschrijving: "Beoordeelt ingediende bezwaren en neemt beslissingen volgens vastgestelde regels.", benodigd: "HBO-diploma, bij voorkeur juridisch. Analytisch vermogen en ervaring met bezwaarprocedures.", opleiding: "HBO", cursus: "Bezwaarafhandeling", vervolg_functie: "Juridisch Medewerker" },
            5: { titel: "Financieel Medewerker", beschrijving: "Beheert en controleert financi√´le transacties en betalingen.", benodigd: "MBO-diploma in financi√´le of administratieve richting. Cijfermatig inzicht en ervaring met financi√´le administratie.", opleiding: "MBO", cursus: "Financi√´le Verantwoording", vervolg_functie: "Financieel Assistent" },
            6: { titel: "ICT Support Medewerker", beschrijving: "Ondersteunt medewerkers bij technische problemen met systemen en software.", benodigd: "MBO-diploma ICT. Technisch inzicht en ervaring met computer- en softwaresupport.", opleiding: "MBO", cursus: "ITIL Foundation", vervolg_functie: "Technisch Support" },
            7: { titel: "Data Analist", beschrijving: "Analyseert gegevens om processen en prestaties inzichtelijk te maken.", benodigd: "HBO-diploma in data, ICT of economie. Ervaring met data-analyse en rapportages.", opleiding: "HBO", cursus: "SQL & Data Visualisatie", vervolg_functie: "Junior Data Analist" },
            8: { titel: "Teamleider", beschrijving: "Stuurt een team aan en bewaakt de kwaliteit en voortgang van het werk.", benodigd: "HBO-diploma. Leidinggevende ervaring en goede organisatorische vaardigheden.", opleiding: "HBO", cursus: "Leidinggeven & Coaching", vervolg_functie: "Senior Medewerker" },
            9: { titel: "Communicatie Medewerker", beschrijving: "Verzorgt interne en externe communicatie van de organisatie.", benodigd: "HBO-diploma communicatie of media. Ervaring met schrijven en communicatie is gewenst.", opleiding: "HBO", cursus: "Copywriting & Strategie", vervolg_functie: "Communicatie Assistent" },
            10: { titel: "HR Medewerker", beschrijving: "Ondersteunt personeelszaken zoals administratie en begeleiding van medewerkers.", benodigd: "MBO-diploma HR of administratie. Ervaring met personeelsadministratie is een pr√©.", opleiding: "MBO", cursus: "Personeelsadministratie", vervolg_functie: "Administratief Medewerker" }
        };

        let functies = { ...defaultData };

        async function loadFuncties() {
            try {
                const res = await fetch(`${API_URL}/functies.php`);
                const data = await res.json();
                if (Object.keys(data).length > 0) {
                    functies = data;
                }
                render();
                autoSelectFromUrl();
            } catch (err) {
                console.error("Kon functies niet laden:", err);
                render();
                autoSelectFromUrl();
            }
        }

        function save() {
            localStorage.setItem('cjib_functies', JSON.stringify(functies));
        }

        async function saveFunctieToDB(data, id = null) {
            const url = id ? `${API_URL}/functies.php?id=${id}` : `${API_URL}/functies.php`;
            try {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return await res.json();
            } catch (err) {
                console.error("Functie kon niet worden opgeslagen:", err);
            }
        }

        function render() {
            const list = document.getElementById('functionList');
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const isAdmin = typeof Auth !== 'undefined' && Auth.isAdmin();

            const addBtn = document.getElementById('addBtn');
            if (addBtn) {
                addBtn.style.display = isAdmin ? 'block' : 'none';
            }

            list.innerHTML = '';
            Object.keys(functies).forEach(id => {
                const f = functies[id];
                if (searchTerm && !f.titel.toLowerCase().includes(searchTerm)) {
                    return;
                }

                const div = document.createElement('div');
                div.className = 'rijk-function-item';

                let buttonsHtml = '';
                if (isAdmin) {
                    buttonsHtml = `
                        <button class="rijk-edit-btn" onclick="editFunctie(${id}, event)">‚úèÔ∏è</button>
                        <button class="rijk-delete-btn" onclick="deleteFunctie(${id}, event)">üóëÔ∏è</button>
                    `;
                }

                div.innerHTML = `
                    <span class="rijk-function-name">${f.titel}</span>
                    <div class="rijk-action-buttons">
                        ${buttonsHtml}
                    </div>
                    <span>‚Üí</span>
                `;
                div.onclick = () => {
                    document.querySelectorAll('.rijk-function-item').forEach(i => i.classList.remove('active'));
                    div.classList.add('active');
                    show(id);
                };
                list.appendChild(div);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', render);
            }
        });

        function deleteFunctie(id, event) {
            event.stopPropagation();
            if (confirm('Weet je zeker dat je deze functie wilt verwijderen?')) {
                delete functies[id];
                save();
                render();
                if (Object.keys(functies).length > 0) {
                    document.querySelector('.rijk-function-item').click();
                }
            }
        }

        let currentSelectedId = null;

        function show(id) {
            currentSelectedId = id;
            const f = functies[id];
            document.getElementById('cardTitle').textContent = f.titel;
            document.getElementById('cardDesc').textContent = f.beschrijving;
            document.getElementById('cardBenodigd').textContent = f.benodigd;
            document.getElementById('cardOpleiding').textContent = f.opleiding;

            localStorage.setItem('routeplanner_selection', JSON.stringify({
                type: 'full',
                id: id
            }));
        }

        function autoSelectFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            if (id && functies[id]) {
                show(id);
                setTimeout(() => {
                    const items = document.querySelectorAll('.rijk-function-item');
                    items.forEach(item => item.classList.remove('active'));
                    const targetTitle = functies[id].titel;
                    let targetItem = null;
                    items.forEach(item => {
                        const titleSpan = item.querySelector('.rijk-function-name');
                        if (titleSpan && titleSpan.textContent === targetTitle) {
                            targetItem = item;
                        }
                    });
                    if (targetItem) {
                        targetItem.classList.add('active');
                        targetItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 100);
            } else if (Object.keys(functies).length > 0) {
                const firstId = Object.keys(functies)[0];
                show(firstId);
                const firstItem = document.querySelector('.rijk-function-item');
                if (firstItem) firstItem.classList.add('active');
            }
        }

        document.getElementById('planRouteBtn').onclick = () => {
            window.location.href = 'routeplanner.html';
        };

        document.getElementById('savePersonalBtn').onclick = () => {
            if (currentSelectedId) {
                const saved = JSON.parse(localStorage.getItem('cjib_saved_personal')) || [];
                if (!saved.includes(currentSelectedId)) {
                    saved.push(currentSelectedId);
                    localStorage.setItem('cjib_saved_personal', JSON.stringify(saved));
                    alert('Functie opgeslagen in "Mijn Functies"!');
                } else {
                    alert('Deze functie is al opgeslagen.');
                }
            }
        };

        loadFuncties();

        let editingId = null;

        document.getElementById('addBtn').onclick = function () {
            editingId = null;
            document.querySelector('#popup h2').textContent = 'Nieuwe functie aanmaken';
            document.getElementById('form').reset();
            document.getElementById('popup').classList.add('active');
        };

        function editFunctie(id, event) {
            event.stopPropagation();
            editingId = id;
            const f = functies[id];

            document.querySelector('#popup h2').textContent = 'Functie bewerken';
            document.getElementById('titel').value = f.titel;
            document.getElementById('cursus').value = f.cursus || '';
            document.getElementById('vervolg_functie').value = f.vervolg_functie || '';
            document.getElementById('beschrijving').value = f.beschrijving;
            document.getElementById('benodigd').value = f.benodigd;
            document.getElementById('opleiding').value = f.opleiding;

            document.getElementById('popup').classList.add('active');
        }

        document.getElementById('cancelBtn').onclick = function () {
            document.getElementById('popup').classList.remove('active');
            document.getElementById('form').reset();
            editingId = null;
        };

        document.getElementById('form').onsubmit = async function (e) {
            e.preventDefault();

            const data = {
                titel: document.getElementById('titel').value,
                cursus: document.getElementById('cursus').value,
                vervolg_functie: document.getElementById('vervolg_functie').value,
                beschrijving: document.getElementById('beschrijving').value,
                benodigd: document.getElementById('benodigd').value,
                opleiding: document.getElementById('opleiding').value
            };

            const result = await saveFunctieToDB(data, editingId);

            if (editingId) {
                functies[editingId] = data;
                alert('Functie bijgewerkt!');
            } else {
                const newId = result.id || Date.now();
                functies[newId] = data;
                alert('Functie toegevoegd!');
            }

            save();
            render();
            document.getElementById('popup').classList.remove('active');
            document.getElementById('form').reset();
            editingId = null;
        };
    </script>
</body>

</html>